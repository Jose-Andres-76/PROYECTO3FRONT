<div class="scanner-form">
  <!-- Tab Navigation -->
  <div class="nav nav-pills nav-fill mb-4" role="tablist" *ngIf="!isAnalyzing && !hasResult">
    <button class="nav-link" 
            [class.active]="activeTab === 'upload'"
            (click)="setActiveTab('upload')"
            type="button">
      <i class="fas fa-upload me-2"></i>
      Subir Imagen
    </button>
    <button class="nav-link" 
            [class.active]="activeTab === 'camera'"
            (click)="setActiveTab('camera')"
            type="button">
      <i class="fas fa-camera me-2"></i>
      Usar Cámara
    </button>
  </div>

  <!-- Analyzed Image Display -->
  <div class="analyzed-image" *ngIf="hasResult && (selectedImage || capturedImage)">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-light">
        <div class="d-flex justify-content-between align-items-center">
          <h6 class="mb-0">
            <i class="fas fa-image me-2"></i>
            Imagen Analizada
          </h6>
          <button class="btn btn-success btn-sm" (click)="scanNewImage()">
            <i class="fas fa-plus me-1"></i>
            Escanear Otra
          </button>
        </div>
      </div>
      <div class="card-body p-3">
        <img [src]="selectedImage || capturedImage" 
             class="analyzed-image-display" 
             alt="Imagen analizada">
      </div>
    </div>
  </div>

  <!-- Upload Section -->
  <div class="upload-section" *ngIf="activeTab === 'upload' && !isAnalyzing && !hasResult">
    <div class="upload-area" 
         (click)="triggerFileInput()"
         (dragover)="onDragOver($event)"
         (dragleave)="onDragLeave($event)"
         (drop)="onFileDrop($event)"
         [class.drag-over]="isDragOver">
      
      <input #fileInput 
             type="file" 
             accept="image/*" 
             class="d-none" 
             (change)="onFileSelected($event)">
      
      <div class="upload-content text-center">
        <div class="upload-icon mb-3">
          <i class="fas fa-cloud-upload-alt"></i>
        </div>
        <h5 class="upload-title mb-2">Arrastra una imagen aquí</h5>
        <p class="upload-subtitle text-muted mb-3">o haz clic para seleccionar desde tu dispositivo</p>
        <div class="supported-formats mb-3">
          <small class="text-muted">
            <i class="fas fa-info-circle me-1"></i>
            Formatos soportados: JPG, PNG, WebP (Max: 10MB)
          </small>
        </div>
        <button type="button" class="btn btn-success btn-lg">
          <i class="fas fa-upload me-2"></i>
          Seleccionar Imagen
        </button>
      </div>
    </div>

    <!-- Image Preview -->
    <div class="image-preview mt-4" *ngIf="selectedImage">
      <div class="preview-card">
        <div class="preview-header">
          <h6 class="mb-0">Vista Previa</h6>
          <button class="btn btn-sm btn-outline-secondary" (click)="clearSelection()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="preview-body">
          <img [src]="selectedImage" class="preview-image" alt="Imagen seleccionada">
          <div class="preview-actions mt-3">
            <button class="btn btn-success btn-lg w-100" 
                    (click)="analyzeImage()"
                    [disabled]="isLoading">
              <i class="fas fa-search me-2"></i>
              Analizar Imagen
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Camera Section -->
  <div class="camera-section" *ngIf="activeTab === 'camera' && !isAnalyzing && !hasResult">
    <div class="camera-container">
      <!-- Video Stream - Siempre renderizado en pestaña cámara -->
      <div class="video-container" *ngIf="activeTab === 'camera'">
        <video #videoElement 
               autoplay 
               playsinline 
               muted 
               class="camera-video"
               [style.display]="isCameraActive ? 'block' : 'none'">
        </video>
        <div class="camera-overlay" *ngIf="isCameraActive">
          <div class="scanning-frame"></div>
        </div>
        
        <!-- Camera Placeholder (mostrado cuando la cámara no está activa) -->
        <div class="camera-placeholder" *ngIf="!isCameraActive">
          <div class="placeholder-content text-center">
            <i class="fas fa-camera display-4 text-muted mb-3"></i>
            <h5 class="text-muted mb-2">Cámara No Activa</h5>
            <p class="text-muted">Presiona "Activar Cámara" para comenzar</p>
          </div>
        </div>
      </div>

      <!-- Camera Controls -->
      <div class="camera-controls mt-3">
        <div class="row g-2">
          <div class="col" *ngIf="!isCameraActive">
            <button class="btn btn-success btn-lg w-100" (click)="startCamera()">
              <i class="fas fa-video me-2"></i>
              Activar Cámara
            </button>
          </div>
          <div class="col-8" *ngIf="isCameraActive">
            <button class="btn btn-success btn-lg w-100" (click)="captureImage()">
              <i class="fas fa-camera me-2"></i>
              Capturar Foto
            </button>
          </div>
          <div class="col-4" *ngIf="isCameraActive">
            <button class="btn btn-outline-secondary btn-lg w-100" (click)="stopCamera()">
              <i class="fas fa-stop"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Captured Image Preview -->
      <div class="captured-preview mt-4" *ngIf="capturedImage && activeTab === 'camera'">
        <div class="preview-card">
          <div class="preview-header">
            <h6 class="mb-0">Foto Capturada</h6>
            <button class="btn btn-sm btn-outline-secondary" (click)="clearCapture()">
              <i class="fas fa-redo"></i>
            </button>
          </div>
          <div class="preview-body">
            <img [src]="capturedImage" class="preview-image" alt="Foto capturada">
            <div class="preview-actions mt-3">
              <button class="btn btn-success btn-lg w-100" 
                      (click)="analyzeImage()"
                      [disabled]="isLoading">
                <i class="fas fa-search me-2"></i>
                Analizar Foto
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <canvas #canvasElement class="d-none"></canvas>
  </div>

  <!-- Analysis Loading State -->
  <div class="analysis-loading text-center py-5" *ngIf="isAnalyzing">
    <div class="loading-animation mb-4">
      <div class="spinner-border text-success" style="width: 4rem; height: 4rem;" role="status">
        <span class="visually-hidden">Analizando...</span>
      </div>
    </div>
    <h4 class="text-success mb-2">
      <i class="fas fa-brain me-2"></i>
      Analizando Imagen
    </h4>
    <p class="text-muted mb-3">Nuestro AI está identificando el tipo de basura...</p>
    <div class="progress progress-lg">
      <div class="progress-bar progress-bar-striped progress-bar-animated" 
           style="width: 75%"></div>
    </div>
    <small class="text-muted mt-2 d-block">Esto puede tomar unos segundos...</small>
  </div>
</div>
