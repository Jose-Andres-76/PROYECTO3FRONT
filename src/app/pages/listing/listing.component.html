@defer {
    <div class="row p-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2>Familia {{user?.lastname}}</h2>
                <button 
                    type="button" 
                    class="btn btn-primary"
                    (click)="openAddFamilyModal()">
                    <i class="fas fa-plus"></i> Agregar miembro de familia
                </button>
            </div>
        </div>
        <div class="col-12">
            <app-family-list
                (callDeleteAction)="deleteFamily($event)"
                (callModalAction)="callEdition($event)"
                [families]="familyService.families$()"
            />
            @if(familyService.families$().length) {
                <app-pagination
                [service]="familyService"
                />
            }
        </div>
        
        <div class="col-12 mt-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>Recompensas de Familia</h2>
                <button 
                    type="button" 
                    class="btn btn-success"
                    (click)="openAddRewardModal()">
                    <i class="fas fa-plus"></i> Agregar recompensa
                </button>
            </div>
            <app-reward-list
                (callDeleteAction)="rewardService.delete($event)"
                (callModalAction)="callRewardEdition($event)"
                [rewards]="rewardService.rewards$()"
            />
            @if(rewardService.rewards$().length) {
                <app-pagination
                [service]="rewardService"
                />
            }
        </div>
    </div>
} @loading (minimum 1.5s){
    <app-loader></app-loader>
} 

<ng-template #addFamilyModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title">Agregar Miembro de Familia</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeAddFamilyModal()">
            <span aria-hidden="true"></span>
        </button>
    </div>
    <div class="modal-body">
        @if(!newSonUser) {
            <app-family-member-form
                #familyMemberFormComponent
                title="Agregar Nuevo Miembro"
                [memberForm]="memberForm"
                [isEditMode]="false"
                (callSaveMethod)="saveFamilyMember($event)"
                (callCancelMethod)="closeAddFamilyModal()"
                (signupCancelled)="closeAddFamilyModal()"
            />
        } @else {
            <div class="text-center">
                <h4>Miembro de familia agregado exitosamente</h4>
                <p>{{newSonUser.name}} {{newSonUser.lastname}} ha sido agregado a tu familia.</p>
                <button type="button" class="btn btn-success" (click)="closeAddFamilyModal()">
                    Cerrar
                </button>
            </div>
        }
    </div>
</ng-template>

<ng-template #editFamilyMemberModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title">Editar Miembro de Familia</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modalService.closeAll()">
            <span aria-hidden="true"></span>
        </button>
    </div>
    <div class="modal-body">
        <div class="alert alert-info mb-3">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Note:</strong> La contraseña es requerida para actualizar la información del miembro de la familia.
        </div>
        <app-family-member-form
            #familyMemberFormComponent
            title="Editar Miembro de Familia"
            [memberForm]="memberForm"
            [isEditMode]="true"
            (callUpdateMethod)="updateFamilyMember($event)"
            (callCancelMethod)="modalService.closeAll()"
        />
    </div>
</ng-template>

<ng-template #addRewardModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title">Agregar Nueva Recompensa</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modalService.closeAll()">
            <span aria-hidden="true"></span>
        </button>
    </div>
    <div class="modal-body">
        <app-reward-form
            title="Agregar Nueva Recompensa"
            (callSaveMethod)="saveReward($event)"
        />
    </div>
</ng-template>

<ng-template #editRewardModal let-modal>
    <div class="modal-header">
        <h4 class="modal-title">Editar Recompensa</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modalService.closeAll()">
            <span aria-hidden="true"></span>
        </button>
    </div>
    <div class="modal-body">
        <app-reward-form
            title="Editar Recompensa"
            [reward]="getSelectedReward()"
            (callUpdateMethod)="updateReward($event)"
        />
    </div>
</ng-template>